{% extends "HAIInterface/layout.html" %}

<body>
{% block content %}
<audio id="myAudio">
    <source src="../static/HAIInterface/img/audio.mp3" type="audio/mpeg">
</audio>

<audio id="bell">
    <source src="../static/HAIInterface/img/bell.mp3" type="audio/mpeg">
</audio>

<div id="main" class="main-content-container">
    <div id ='title' class="general-title">Inflight Control</div>
    <div class="subcontent-container" style="flex-grow: 1; justify-content: space-evenly;">
     <div class="inflight-button-grid">
        <div id="emergency-landing" class="grid-button emergency-landing ">Emergency Landing</div>
        <div id="return-departure" class="grid-button return-departure">Return to Departure Location</div>
        <div id="change-destination"  class="grid-button change-destination">Change Destination</div>
        <div id="change-altitude"  class="grid-button change-altitude">Change Altitude</div>
     </div>
    </div>

</div>

{% endblock %}
</body>

<script>
{% block script %}
    var HelpId=4;
    let lastClicked = 0
    let TargetIndex = 100
    var audio = document.getElementById("myAudio"); 
    var bell = document.getElementById("bell"); 
    document.getElementById('help').onclick = () => { log({"page": "Inflight", "action": "help button pressed"}); window.location.href = '/hai-interface/help?num=' + HelpId }
    document.getElementById("emergency-landing").onclick = () => { log({"page": "Inflight", "action": "emergency landing button pressed"}); window.location.href = '/hai-interface/change-destination?inflight=' + 1 + '&emergency=' + 1 }
    document.getElementById("return-departure").onclick = () => {  log({"page": "Inflight", "action": "return to departure button pressed"}); window.location.href = '/hai-interface/location?inflight=' + 1 + '&dest=' + 19 }
    document.getElementById("change-destination").onclick = () => {  log({"page": "Inflight", "action": "change destination button pressed"}); window.location.href = '/hai-interface/change-destination?inflight=' + 1 }
    document.getElementById("change-altitude").onclick = () => { log({"page": "Inflight", "action": "change altitude button pressed"}); window.location.href = '/hai-interface/change-altitude?Changed_altitude='+ 10000 }


    document.getElementById('help').href='/hai-interface/help?num='+HelpId
    document.getElementById('map').href = '/hai-interface/map'
    document.getElementById('cruise-sidebar').style.backgroundColor = "pink"


    // vitals reminder, onclick for the vital reminder done button
    document.getElementById("vitals-acknowledge-button").onclick = () => {
        log({"page": "inflight", "action": "user acknowledged vitals prompt"})
        document.getElementById('vitals').style.display = "none"
        lastClicked = new window.Date().getTime()
        bell.pause()
    } 

    // interval for the inflight stage
    setInterval(() => {
        var curr = new window.Date().getTime()
        if (emergencyState == 0 && curr - lastClicked > 60000 && timeToDestination>0.5) {
            log({"page": "inflight", "action": "displaying vitals prompt"})
            lastClicked = Infinity  // set to infinity so it does not immediately trigger
            document.getElementById('vitals').style.display = "flex"
            bell.play()
            bell.volume=0.2;
    }}, 350)

{% endblock %}
</script>
